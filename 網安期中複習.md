### **什麼是電腦安全、網路安全和網際網路安全？它們之間有什麼區別？**

電腦安全是一個廣泛的術語，指的是用於保護資料和阻止駭客入侵的各種工具的集合。網路安全專注於保護資料在傳輸過程中的安全。網際網路安全則是網路安全的一個特定子集，它關注的是在相互連接的網路（即網際網路）上傳輸資料時所採取的保護措施。本課程主要關注網際網路安全。

### **資訊安全的三個主要方面是什麼？**

資訊安全有三個主要方面：安全攻擊（任何危害組織擁有資訊安全的行為）、安全機制（用於偵測、預防或從安全攻擊中恢復的功能）以及安全服務（增強資料處理系統和資訊傳輸安全性的服務，旨在對抗安全攻擊並通常使用一個或多個安全機制）。

### **什麼是安全攻擊？有哪些主要的通用類型？**

安全攻擊是任何損害組織所擁有資訊安全性的行為。廣泛來說，安全攻擊可以分為兩種類型：被動攻擊和主動攻擊。被動攻擊旨在未經授權地獲取資訊而不影響系統資源，例如竊聽。主動攻擊則試圖修改系統資源或影響其運作，例如偽造訊息或拒絕服務攻擊。

### **X.800標準中定義了哪些主要的安全性服務？**

ITU-T X.800“OSI安全架構”定義了多種安全性服務，包括：

- **身份驗證 (Authentication)**：確保通信實體是其聲稱的實體。
- **存取控制 (Access Control)**：防止未經授權使用資源。
- **資料機密性 (Data Confidentiality)**：保護資料免受未經授權的洩露。
- **資料完整性 (Data Integrity)**：確保收到的資料與授權實體發送的資料完全一致。
- **不可否認性 (Non-Repudiation)**：防止通信中的一方否認其參與了通信。
- **可用性服務 (Availability Service)**：確保授權系統實體可以存取和使用資源。

### **安全機制的主要目的是什麼？並舉例說明。**

安全機制是一種旨在偵測、預防或從安全攻擊中恢復的功能。沒有單一的機制可以支援所有需要的安全服務。然而，密碼學技術是許多安全機制的基礎。X.800標準中定義的特定安全機制包括加密、數位簽章、存取控制、資料完整性機制、身份驗證交換、流量填充、路由控制和公證。普遍存在的安全機制包括可信賴的功能、安全標籤、事件偵測、安全稽核追蹤和安全恢復。

### **保護網路安全有哪些常見的防禦方法？**

保護網路安全的常見防禦方法包括：

- **加密 (Encryption)**：將資料轉換為無法讀取的格式以保護其機密性。
- **軟體控制 (Software Controls)**：例如資料庫中的存取限制，以及作業系統中保護不同使用者之間資料的機制。
- **硬體控制 (Hardware Controls)**：例如智慧卡，用於提供額外的安全層。
- **策略 (Policies)**：例如定期更改密碼的規定，以降低未經授權存取的風險。
- **實體控制 (Physical Controls)**：例如限制對機房的物理存取。

### **網路安全模型的主要步驟是什麼？**

網路安全模型主要涉及以下步驟：

1. 設計適用於安全轉換的演算法。
2. 產生演算法使用的秘密資訊（金鑰）。
3. 開發分發和共享秘密資訊的方法。
4. 指定一個協定，使參與者能夠使用轉換和秘密資訊來實現安全服務。

### **在網路存取安全模型中，需要考慮哪些關鍵要素？**

網路存取安全模型需要考慮以下關鍵要素：

1. 選擇適當的守門員功能來識別使用者。
2. 實施安全控制以確保只有授權使用者才能存取指定的資訊或資源。 可信任的電腦系統可能有助於實施此模型。
## 第二章
### **本章大綱複習**

- 傳統加密原則
- 傳統加密演算法
- 密碼區塊運作模式
- 加密裝置的位置
- 金鑰分配

### **基礎術語**

- **明文 (plaintext)**：原始訊息。
- **密文 (ciphertext)**：編碼後的訊息。
- **密碼 (cipher)**：將明文轉換為密文的演算法。
- **金鑰 (key)**：密碼中使用的資訊，只有發送者和接收者知道。
- **加密 (encipher/encrypt)**：將明文轉換為密文的過程。
- **解密 (decipher/decrypt)**：從密文中恢復明文的過程。
- **密碼學 (cryptography)**：研究加密原則和方法。
- **密碼分析 (cryptanalysis/codebreaking)**：研究在不知道金鑰的情況下解密密文的原則和方法。
- **密碼學 (cryptology)**：包含密碼學和密碼分析的領域。

### **密碼學**

- 根據三個獨立的面向進行分類：
- **操作類型**：將明文轉換為密文所使用的操作類型，包括替換 (substitution)、置換 (transposition) 和乘積 (product)。
- **金鑰數量**：加密和解密過程中使用的金鑰數量，分為對稱式 (單一金鑰) 和非對稱式 (雙金鑰或公開金鑰加密)。
- **明文處理方式**：明文的處理方式，分為區塊 (block) 和串流 (stream)。

### **密碼分析**

- 目標不僅是恢復訊息，更重要的是恢復金鑰。
- 一般方法：
- 密碼分析攻擊 (cryptanalytic attack)
- 暴力破解攻擊 (brute-force attack)

### **暴力破解搜尋**

- 總是可能嘗試所有可能的金鑰。
- 是最基本的攻擊方式，所需時間與金鑰大小成正比。

### 傳統加密原則

### **對稱式加密**

- 又稱為傳統式 (conventional)、私鑰式 (private-key) 或單一金鑰式 (single-key) 加密。
- 發送者和接收者共享相同的金鑰。
- 所有古典加密演算法都是私鑰加密。
- 在 1970 年代公開金鑰發明之前，這是唯一存在的加密類型。
- 至今仍然是最廣泛使用的加密方式。

### **對稱式加密術語**

- 一個對稱式加密方案包含五個要素：
- 明文 (Plaintext)
- 加密演算法 (Encryption algorithm)
- 秘密金鑰 (Secret Key)
- 密文 (Ciphertext)
- 解密演算法 (Decryption algorithm)
- 安全性取決於金鑰的保密性，而不是演算法的保密性。

### 對稱式密碼模型

### **要求**

- 安全使用對稱式加密的兩個基本要求：
- 一個強大的加密演算法。
- 一個只有發送者和接收者知道的秘密金鑰。
- 數學表示：
- Y = EK(X) (使用金鑰 K 加密明文 X 得到密文 Y)
- X = DK(Y) (使用金鑰 K 解密密文 Y 得到明文 X)
- 假設加密演算法是公開的，因此需要一個安全的通道來分配金鑰。

### 傳統加密演算法

### **古典替換式密碼**

- 明文中的字母被其他字母、數字或符號替換。
- 或者，如果將明文視為位元序列，則替換涉及用密文位元模式替換明文位元模式。

### 凱撒密碼

- 已知最早的替換式密碼。
- 由朱利烏斯·凱撒所使用。
- 首次有記載的使用是在軍事事務上。
- 將每個字母替換為其後第三個字母。

### 凱撒密碼

- 轉換可以定義為：
- a b c d e f g h i j k l m n o p q r s t u v w x y z 對應 D E F G H I J K L M N O P Q R S T U V W X Y Z A B C
- 數學上，將每個字母賦予一個數字：
- a=0, b=1, c=2, ..., z=25
- 凱撒密碼可以表示為：
- 加密：c = E(p) = (p + k) mod 26 (其中 k=3)
- 解密：p = D(c) = (c – k) mod 26 (其中 k=3)

### 凱撒密碼的密碼分析

- 只有 25 種可能的密碼 (A 映射到 B, ..., Z)。
- 可以簡單地逐一嘗試每一種可能性。
- 是一種暴力破解搜尋。
- 給定密文，只需嘗試所有可能的字母位移。
- 需要能夠辨識何時得到有意義的明文。

### 英文字母頻率

#### 在密碼分析中的應用

- 核心概念 - 單字母替換密碼不會改變相對字母頻率。
- 由阿拉伯科學家在 9 世紀發現。
- 計算密文中的字母頻率。
- 將計算結果與已知的字母頻率進行比較。
- 如果是凱撒密碼，尋找常見的頻率高峰和低谷。
- 高峰通常出現在：A-E-I (單個字母), NO (雙字母), RST (三字母)。
- 低谷通常出現在：JK, X-Z。
- 對於一般的單字母替換密碼，必須識別每個字母的對應關係。
- 常見的雙字母和三字母組合表可以提供幫助。

### 一次性密碼本 (One-Time Pad)

- 如果使用一個真正隨機、長度與訊息相同的金鑰，則該密碼是安全的。
- 稱為一次性密碼本。
- 是不可破解的，因為密文與明文之間沒有任何統計關係。
- 因為對於任何明文和任何密文，都存在一個將一個映射到另一個的金鑰。
- 但每個金鑰只能使用一次。
- 在金鑰的產生和安全分發方面存在問題。

### 置換式密碼 (Transposition Ciphers)

- 現在考慮古典置換或排列密碼。
- 這些密碼通過重新排列字母的順序來隱藏訊息。
- 不改變實際使用的字母。
- 可以通過其與原始文本相同的頻率分佈來識別。

## 鐵路柵欄密碼 (Rail Fence Cipher)

- 將訊息字母沿對角線寫在若干行上。
- 然後逐行讀取以得到密文。

## 行置換密碼 (Row Transposition Ciphers)

- 一種更複雜的置換方式。
- 將訊息字母按列寫在指定數量的行上。
- 然後根據某個金鑰重新排列列的順序，最後逐行讀取以得到密文。

## 乘積密碼 (Product Ciphers)

- 單獨使用替換或置換密碼由於語言特性而不安全。
- 因此考慮連續使用多個密碼來增加破解難度，但：
- 兩個替換構成一個更複雜的替換。
- 兩個置換構成一個更複雜的置換。
- 但是，一個替換後跟一個置換會產生一個新的、更難破解的密碼。
- 這是從古典密碼到現代密碼的橋樑。

## 現代區塊密碼 (Modern Block Ciphers)

- 現在來看現代區塊密碼。
- 是最廣泛使用的加密演算法類型之一。
- 提供保密性和身份驗證服務。
- 重點介紹 DES (資料加密標準)，以說明區塊密碼的設計原則。

## 區塊密碼 vs 串流密碼 (Block vs Stream Ciphers)

- 區塊密碼將訊息分成固定大小的區塊，然後對每個區塊進行加密/解密。
- 類似於對非常大的字元進行替換 (例如 64 位元或更多)。
- 串流密碼在加密/解密時，一次處理訊息的一個位元或一個位元組。

## 區塊密碼原則 (Block Cipher Principles)

- 大多數對稱式區塊密碼都基於 Feistel 密碼結構。
- 這是必要的，因為必須能夠有效地解密密文以恢復訊息。
- 區塊密碼看起來像一個極大的替換。
- 對於一個 64 位元的區塊，需要一個包含 2^64 個條目的表。
- 取而代之的是使用較小的構建塊，並利用乘積密碼的思想來創建。

## 理想區塊密碼 (Ideal Block Cipher)

## 克勞德·夏農與替換-置換網路 (Claude Shannon and Substitution-Permutation Ciphers)

- 克勞德·夏農在 1949 年的論文中提出了替換-置換 (S-P) 網路的概念。
- 這是現代區塊密碼的基礎。
- S-P 網路基於之前看到的兩個原始密碼學操作：
- 替換 (S-盒)
- 置換 (P-盒)
- 提供訊息和金鑰的混淆 (confusion) 和擴散 (diffusion)。

## 混淆與擴散 (Confusion and Diffusion)

- 密碼需要完全模糊原始訊息的統計特性。
- 一次性密碼本可以做到這一點。
- 更實際地，夏農建議結合 S 和 P 元素以獲得：
- 擴散 (diffusion) – 將明文的統計結構分散到整個密文中。
- 混淆 (confusion) – 使密文和金鑰之間的關係盡可能複雜。

## Feistel 密碼結構 (Feistel Cipher Structure)

- Horst Feistel 設計了 Feistel 密碼。
- 基於可逆乘積密碼的概念。
- 將輸入區塊劃分為兩個相等的部分。
- 通過多輪處理。
- 每輪對左半部分資料進行替換。
- 替換基於右半部分資料和子金鑰的輪函數。
- 然後進行置換，交換左右兩半部分。
- 實現了夏農的 S-P 網路概念。

## Feistel 密碼結構

## Feistel 密碼設計要素 (Feistel Cipher Design Elements)

- 區塊大小 (block size)
- 金鑰大小 (key size)
- 輪數 (number of rounds)
- 子金鑰產生演算法 (subkey generation algorithm)
- 輪函數 (round function)
- 快速的軟體加密/解密 (fast software en/decryption)
- 易於分析 (ease of analysis)

## Feistel 密碼解密 (Feistel Cipher Decryption)

## 資料加密標準 (DES)

- 世界上使用最廣泛的區塊密碼。
- 1977 年被 NBS (現為 NIST) 採納為 FIPS PUB 46 標準。
- 使用 56 位元金鑰加密 64 位元資料。
- 應用廣泛。
- 其安全性一直存在相當大的爭議。

## DES 歷史 (DES History)

- IBM 開發了 Lucifer 密碼。
- 由 Feistel 在 60 年代末領導的團隊開發。
- 使用 64 位元資料區塊和 128 位元金鑰。
- 然後在 NSA 和其他機構的參與下重新開發為商業密碼。
- 1973 年，NBS 發布了國家密碼標準的提案徵集。
- IBM 提交了其修訂後的 Lucifer，最終被接受為 DES。

## DES 設計爭議 (DES Design Controversy)

- 儘管 DES 標準是公開的，但其設計一直存在相當大的爭議。
- 在 56 位元金鑰的選擇 (相對於 Lucifer 的 128 位元) 上。
- 並且因為設計標準是機密的。
- 隨後的事件和公開分析表明，事實上該設計是適當的。
- DES 的使用蓬勃發展。
- 尤其是在金融應用中。
- 仍然是傳統應用使用的標準。

## DES 加密概述 (DES Encryption Overview)

## 初始置換 IP (Initial Permutation IP)

- 資料計算的第一步。
- IP 重新排列輸入資料的位元。
- 偶數位元移動到左半部分，奇數位元移動到右半部分。
- 結構相當規律 (硬體實現容易)。

## 初始置換 IP

## 逆初始置換 IP-1 (Inverse Initial Permutation IP-1)

## DES 輪結構 (DES Round Structure)

- 使用兩個 32 位元的 L 和 R 半部分。
- 與任何 Feistel 密碼一樣，可以描述為：
- Li = Ri–1
- Ri = Li–1 ⊕ F(Ri–1, Ki)
- F 函數接受 32 位元的 R 半部分和 48 位元的子金鑰：
- 使用置換 E 將 R 擴展到 48 位元。
- 使用 XOR 與子金鑰相加。
- 通過 8 個 S-盒得到 32 位元的結果。
- 最後使用 32 位元的置換 P 進行置換。

## DES F 函數 (DES F Function)

## DES 擴展結構 (DES Expansion Structure)

## DES 輪結構

## 替換盒 S (Substitution Boxes S)

- 有八個 S-盒，每個將 6 位元映射到 4 位元。
- 每個 S-盒實際上是 4 個小的 4 位元盒。
- 外部位元 1 和 6 (行位元) 選擇 4 個中的一行。
- 內部位元 2-5 (列位元) 被替換。
- 結果是 8 組 4 位元，即 32 位元。
- 行選擇取決於資料和金鑰。
- 稱為自密鑰 (autokeying) 的特性。

## 替換盒 S

## DES 金鑰排程 (DES Key Schedule)

- 產生每輪使用的子金鑰。
- 對金鑰進行初始置換 (PC1)，選擇 56 位元分為兩個 28 位元的部分。
- 16 個階段組成：
- 根據金鑰輪換表 K，分別將每個半部分循環左移 1 或 2 位元。
- 從每個半部分選擇 24 位元，並使用 PC2 進行置換，用於輪函數 F。
- 注意硬體與軟體實現中的實際使用問題。

## DES 金鑰排程

## DES 解密 (DES Decryption)

- 解密必須逆轉資料計算的步驟。
- 對於 Feistel 設計，再次執行加密步驟，但使用相反順序的子金鑰 (SK16 ... SK1)。
- IP 的逆運算抵消了加密的最後一步 FP。
- 使用 SK16 的第一輪解密抵消了第 16 輪加密。
- ...
- 使用 SK1 的第 16 輪解密抵消了第一輪加密。
- 然後最後的 FP 逆運算抵消了初始加密 IP，從而恢復了原始資料值。

## DES 輸入/輸出 (DES I/O)

## DES 強度 – 金鑰大小 (Strength of DES – Key Size)

- 56 位元金鑰有 2^56 = 7.2 x 10^16 個可能值。
- 暴力破解搜尋看起來很困難。
- 最近的進展表明這是可能的。
- 1997 年在網際網路上花了幾個月。
- 1998 年在專用硬體 (EFF) 上花了幾天。
- 1999 年以上兩種方式結合，只花了 22 小時！
- 仍然必須能夠識別明文。
- 現在必須考慮 DES 的替代方案。

## DES 強度 – 分析攻擊 (Strength of DES – Analytic Attacks)

- 現在有幾種針對 DES 的分析攻擊。
- 這些攻擊利用了密碼的一些深層結構。
- 通過收集關於加密的資訊。
- 最終可以恢復一些或所有的子金鑰位元。
- 如有必要，然後對剩餘部分進行窮舉搜索。
- 通常這些是統計攻擊，包括：
- 差分密碼分析 (differential cryptanalysis)
- 線性密碼分析 (linear cryptanalysis)
- 相關金鑰攻擊 (related key attacks)

## DES 強度 – 時間攻擊 (Strength of DES – Timing Attacks)

- 攻擊密碼的實際實現。
- 利用實現後果的知識來推導關於某些或所有子金鑰位元的資訊。
- 特別是利用了計算時間可能因輸入值而異的事實。
- 在智慧卡上尤其成問題。

## 區塊密碼設計 (Block Cipher Design)

- 基本原則仍然類似於 Feistel 在 1970 年代的設計。
- 輪數：越多越好，窮舉搜尋是最好的攻擊方式。
- 函數 F：提供「混淆」，是非線性的，具有雪崩效應。S-盒的選擇存在問題。
- 金鑰排程：複雜的子金鑰創建，金鑰雪崩效應。

## 三重 DES 與三個金鑰 (Triple-DES with Three-Keys)

- 雖然對使用兩個金鑰的三重 DES 沒有實際的攻擊，但有一些跡象表明可能存在風險。
- 可以使用三個金鑰的三重 DES 來避免這些風險。
- C = EK3(DK2(EK1(P)))
- 已被一些網際網路應用採用，例如 PGP, S/MIME。

## AES 起源 (AES Origins)

- 顯然需要 DES 的替代方案。
- 存在可以破解它的理論攻擊。
- 已演示過窮舉金鑰搜尋攻擊。
- 可以使用三重 DES – 但速度慢，區塊大小小。
- 美國 NIST 在 1997 年發布了密碼徵集。
- 1998 年 6 月接受了 15 個候選方案。
- 1999 年 8 月縮減到 5 個候選方案。
- 2000 年 10 月，Rijndael 被選為 AES。
- 2001 年 11 月，作為 FIPS PUB 197 標準發布。

## AES 要求 (AES Requirements)

- 私鑰對稱式區塊密碼。
- 128 位元資料，128/192/256 位元金鑰。
- 比三重 DES 更強更快。
- 20-30 年的有效壽命 (+ 檔案用途)。
- 提供完整的規格和設計細節。
- 提供 C 和 Java 實現。
- NIST 已發布所有提交和非機密分析。

## AES 評估標準 (AES Evaluation Criteria)

- 初始標準：
- 安全性 – 實際密碼分析的難度。
- 成本 – 就計算效率而言。
- 演算法和實現特性。
- 最終標準：
- 一般安全性。
- 軟體和硬體實現的便利性。
- 實現攻擊。
- 靈活性 (在加密/解密、金鑰管理、其他方面)。

## AES 短名單 (AES Shortlist)

- 經過測試和評估後，1999 年 8 月的短名單：
- MARS (IBM) - 複雜、快速、高安全餘裕。
- RC6 (美國) - 非常簡單、非常快速、低安全餘裕。
- Rijndael (比利時) - 簡潔、快速、良好安全餘裕。
- Serpent (歐洲) - 慢速、簡潔、非常高安全餘裕。
- Twofish (美國) - 複雜、非常快速、高安全餘裕。
- 然後進行進一步的分析和評論。
- 看到具有以下特徵的演算法之間的對比：
- 少數複雜的輪次與許多簡單的輪次。
- 改進現有密碼與新的提案。

## AES 密碼 - Rijndael

- 由比利時的 Rijmen-Daemen 設計。
- 具有 128/192/256 位元金鑰和 128 位元資料區塊。
- 是一種迭代式而非 Feistel 式的密碼。
- 將資料視為 4 列 4 位元組的區塊進行處理。
- 每一輪都對整個資料區塊進行操作。
- 設計目標：
- 抵抗已知的攻擊。
- 在許多 CPU 上具有速度和程式碼緊湊性。
- 設計簡潔。

## Rijndael

- 4 列 4 位元組的資料區塊稱為狀態 (state)。
- 金鑰被擴展為字組陣列。
- 具有 9/11/13 輪，在每一輪中狀態經歷以下轉換：
- 位元組替換 (ByteSub) – 使用一個 S-盒替換每個位元組。
- 移位列 (ShiftRows) – 在群組/列之間置換位元組。
- 混淆列 (MixColumns) – 使用矩陣乘法對群組進行替換。
- 加入輪金鑰 (AddRoundKey) – 將狀態與輪金鑰材料進行 XOR 運算。
- 可以看作是交替進行的 XOR 金鑰運算和擾亂資料位元組的過程。
- 包括初始的 XOR 金鑰材料和不完整的最後一輪。
- 可以使用快速的 XOR 和查表法實現。

## AES 演算法：加密 (AES Algorithm: Cipher)

## Rijndael

## AES 輪 (AES Round)

## AES 解密 (AES Decryption)

- AES 解密與加密並不完全相同，因為步驟是相反的。
- 但可以定義一個等效的逆密碼，其步驟與加密類似。
- 但使用每個步驟的逆運算。
- 使用不同的金鑰排程。
- 這樣做是可行的，因為當：
- 交換位元組替換和移位列。
- 交換混淆列和加入 (調整後的) 輪金鑰時，結果不變。

## AES 演算法：逆密碼 (AES Algorithm: Inverse Cipher)

## AES 解密

## 密碼區塊運作模式 (Cipher Block Modes of Operation)

## 運作模式 (Modes of Operation)

- 區塊密碼加密固定大小的區塊。
- 例如，DES 使用 56 位元金鑰加密 64 位元的區塊。
- 在實務中，需要某種方法來加密/解密任意大小的資料。
- ANSI X3.106-1983 使用模式 (現為 FIPS 81) 定義了 4 種可能的模式。
- 隨後為 AES 和 DES 定義了 5 種模式。
- 包括區塊模式和串流模式。

## 電子密碼本模式 (ECB)

- 訊息被分成獨立的區塊，然後單獨加密。
- 每個區塊的值都被替換，就像一個密碼本一樣，因此得名。
- 每個區塊的編碼都獨立於其他區塊。
- Ci = DESK1(Pi)
- 用途：安全傳輸單個值。

## 電子密碼本模式 (ECB)

## ECB 的優點與限制 (Advantages and Limitations of ECB)

- 訊息中的重複模式可能會在密文中顯現出來。
- 如果與訊息區塊對齊。
- 尤其是在圖形資料或幾乎不變的訊息中，這會變成一個密碼本分析問題。
- 弱點在於加密後的訊息區塊是相互獨立的。
- 主要用途是傳送少量資料區塊。

## 密碼區塊鏈模式 (CBC)

- 訊息被分成區塊。
- 在加密操作中，區塊被鏈接在一起。
- 每個密文區塊都與當前的明文區塊進行鏈接 (XOR 運算)，因此得名。
- 使用初始向量 (IV) 來開始這個過程。
- Ci = DESK1(Pi ⊕ Ci−1)
- C−1 = IV
- 用途：大量資料加密，身份驗證。

## 密碼區塊鏈模式 (CBC)

## 訊息填充 (Message Padding)

- 在訊息的末尾，必須處理可能出現的最後一個短區塊。
- 其大小小於密碼的區塊大小。
- 可以使用已知的非資料值 (例如 null) 進行填充。
- 或者填充最後一個區塊，並包含填充大小的計數。
- 例如：[b1 b2 b3 0 0 0 0 5] 表示有 3 個資料位元組，然後是 5 個位元組的填充 + 計數。
- 這可能需要在訊息的區塊數量之外增加一個完整的區塊。
- 還有其他更深奧的模式，可以避免需要額外的區塊。

## CBC 的優點與限制 (Advantages and Limitations of CBC)

- 一個密文區塊取決於其之前的所有區塊。
- 對任何一個區塊的更改都會影響所有後續的密文區塊。
- 需要初始向量 (IV)。
- 發送者和接收者都必須知道 IV。
- 如果以明文發送 IV，攻擊者可以更改第一個區塊的位元，並更改 IV 以進行補償。
- 因此，IV 必須是一個固定值 (如 EFTPOS 中使用的)，或者必須在以 ECB 模式加密後，再發送訊息的其餘部分。

## 密碼回饋模式 (CFB)

- 訊息被視為位元串流。
- 區塊密碼的輸出與訊息進行 XOR 運算。
- 結果被回饋到下一階段 (因此得名)。
- 標準允許回饋任意數量的位元 (1, 8, 64 或 128 等)。
- 表示為 CFB-1, CFB-8, CFB-64, CFB-128 等。
- 最有效的方式是使用區塊中的所有位元 (64 或 128)。
- Ci = Pi ⊕ DESK1(Ci−1)
- C−1 = IV
- 用途：串流資料加密，身份驗證。

## 密碼回饋模式 (CFB)

## CFB 的優點與限制 (Advantages and Limitations of CFB)

- 當資料以位元/位元組的形式到達時適用。
- 最常見的串流模式。
- 限制是在每 n 位元後需要暫停以執行區塊加密。
- 注意，區塊密碼在兩端都以加密模式使用。
- 錯誤在錯誤發生後的幾個區塊內傳播。

## 輸出回饋模式 (OFB)

- 訊息被視為位元串流。
- 密碼的輸出與訊息進行 XOR 運算。
- 輸出然後被回饋 (因此得名)。
- 回饋獨立於訊息。
- 可以預先計算。
- Ci = Pi ⊕ Oi
- Oi = DESK1(Oi−1)
- O−1 = IV
- 用途：在雜訊通道上進行串流加密。

## 輸出回饋模式 (OFB)

## OFB 的優點與限制 (Advantages and Limitations of OFB)

- 位元錯誤不會傳播。
- 更容易受到訊息流修改的影響。
- 是 Vernam 密碼的一種變體。
- 因此，絕對不能重複使用相同的序列 (金鑰 + IV)。
- 發送者和接收者必須保持同步。
- 最初規定使用 m 位元回饋。
- 後來的研究表明，應該只使用完整區塊回饋 (即 CFB-64 或 CFB-128)。

## 計數器模式 (CTR)

- 一種「新的」模式，儘管很早就被提出。
- 類似於 OFB，但加密的是計數器值，而不是任何回饋值。
- 每個明文區塊都必須使用不同的金鑰和計數器值 (絕不重複使用)。
- Ci = Pi ⊕ Oi
- Oi = DESK1(i)
- 用途：高速網路加密。

## 計數器模式 (CTR)

## CTR 的優點與限制 (Advantages and Limitations of CTR)

- 效率：
- 可以在硬體或軟體中並行加密。
- 可以在需要之前預先處理。
- 適用於突發性高速鏈路。
- 可隨機存取加密的資料區塊。
- 安全性可證明 (與其他模式一樣好)。
- 但必須確保絕不重複使用金鑰/計數器值，否則可能被破解 (參見 OFB)。

## 串流密碼 (Stream Ciphers)

- 逐位元 (作為串流) 處理訊息。
- 具有偽隨機金鑰串流。
- 與明文逐位元進行 XOR 運算。
- 金鑰串流的隨機性完全破壞了訊息中的統計特性。
- Ci = Mi ⊕ StreamKeyi
- 但絕不能重複使用金鑰串流。
- 否則可以恢復訊息 (參見區塊密碼)。

## 串流密碼結構 (Stream Cipher Structure)

## 串流密碼特性 (Stream Cipher Properties)

- 一些設計考量：
- 具有長週期且不重複。
- 統計上是隨機的。
- 取決於足夠大的金鑰。
- 具有較大的線性複雜度。
- 設計得當的串流密碼可以像具有相同金鑰大小的區塊密碼一樣安全。
- 但通常更簡單且更快。

## RC4

- RSA DSI 擁有的專利密碼。
- Ron Rivest 的另一個設計，簡單但有效。
- 可變金鑰大小，面向位元組的串流密碼。
- 廣泛使用 (網路 SSL/TLS, 無線 WEP)。
- 金鑰形成所有 8 位元值的隨機排列。
- 使用該排列來擾亂逐位元組處理的輸入資訊。

## RC4 金鑰排程 (RC4 Key Schedule)

- 從一個數字陣列 S 開始：0..255。
- 使用金鑰徹底打亂 S。
- S 形成密碼的內部狀態。

## RC4 加密 (RC4 Encryption)

- 加密持續打亂陣列值。
- 一對打亂後的數字之和用於從排列中選擇「金鑰串流」值。
- 將 S[t] 與訊息的下一個位元組進行 XOR 運算以進行加密/解密。

## RC4 概述

## RC4 安全性 (RC4 Security)

- 聲稱對已知攻擊是安全的。
- 有一些分析，但沒有實際的攻擊案例。
- 結果是非常非線性的。
- 由於 RC4 是一種串流密碼，絕不能重複使用金鑰。
- 對 WEP 存在一些擔憂，但這是由於金鑰處理方式，而不是 RC4 本身。

## 加密裝置的位置 (Location of Encryption Devices)

## 加密位置 (Placement of Encryption)

- 主要有兩種放置方式：
- **鏈路加密 (link encryption)**：每個鏈路上獨立進行加密。這意味著鏈路之間的流量必須解密。需要許多設備，但金鑰是成對的。
- **端到端加密 (end-to-end encryption)**：加密發生在原始來源和最終目的地之間。需要在兩端都有共享金鑰的設備。

## 加密位置

## 加密位置

- 當使用端到端加密時，必須將標頭保持為明文。
- 這樣網路才能正確路由資訊。
- 因此，儘管內容受到保護，但流量模式並未受到保護。
- 理想情況下，希望同時實現兩者。
- 端到端加密保護整個路徑上的資料內容，並提供身份驗證。
- 鏈路加密保護流量模式免受監控。

## 加密位置

- 可以在 OSI 參考模型的不同層次放置加密功能。
- 鏈路加密發生在第 1 層或第 2 層。
- 端到端加密可以發生在第 3、4、6、7 層。
- 層次越高，加密的資訊越少，但由於涉及更多實體和金鑰，因此更安全但也更複雜。

## 加密 vs 協定層 (Encryption vs Protocol Level)

## 流量分析 (Traffic Analysis)

- 是對參與方之間通訊流量的監控。
- 在軍事和商業領域都有用。
- 也可以用於創建隱蔽通道。
- 鏈路加密模糊了標頭細節。
- 但網路和端點的總體流量仍然可見。
- 流量填充可以進一步模糊流量。
- 但代價是持續的流量。

## 流量填充加密 (Traffic Padding Encryption)

## 金鑰分配 (Key Distribution)

## 金鑰分配

- 對稱式加密方案要求雙方共享一個共同的秘密金鑰。
- 問題是如何安全地分配這個金鑰。
- 通常，安全系統的失敗是由於金鑰分配方案中的漏洞。

## 金鑰分配

- 給定參與方 A 和 B，有以下金鑰分配替代方案：

1. A 選擇金鑰並親自交付給 B。
2. 第三方選擇金鑰並交付給 A 和 B。
3. 如果 A 和 B 之前有過通訊，可以使用之前的金鑰加密一個新的金鑰。
4. 如果 A 和 B 與第三方 C 有安全的通訊，C 可以作為 A 和 B 之間的中繼來傳送金鑰。

## 金鑰層級 (Key Hierarchy)

- 通常有一個金鑰的層級結構。
- **會期金鑰 (session key)**：
- 臨時金鑰。
- 用於使用者之間資料加密。
- 在一次邏輯會期後被丟棄。
- **主金鑰 (master key)**：
- 用於加密會期金鑰。
- 由使用者和金鑰分配中心 (KDC) 共享。

## 金鑰分配情境 (Key Distribution Scenario)

## 金鑰分配問題 (Key Distribution Issues)

- 大型網路需要 KDC 的層級結構，但必須相互信任。
- 為了更高的安全性，會期金鑰的生命週期應該有限制。
- 代表使用者自動進行金鑰分配，但必須信任系統。
- 使用分散式金鑰分配。
- 控制金鑰的使用。

## 透明金鑰控制 (Transparent Key Control)

### 自動金鑰分配 (Automatic Key Distribution)

## 分散式金鑰分配 (Decentralized Key Distribution)

## 總結 (Summary)

**已考慮：**
- 古典密碼技術和術語。
- 替換式密碼：凱撒密碼。
- 置換式密碼。
- 區塊密碼 vs 串流密碼。
- Feistel 密碼設計與結構。
- DES, 3DES, AES, RC4。
- 對稱式加密的使用和位置。
- 良好金鑰分配的需求。
- 使用受信任第三方 KDC 進行加密。

## 隨堂測驗

1. 請簡要解釋對稱式加密的主要原則，並舉出一個古典的對稱式加密演算法的例子。
2. 區塊密碼和串流密碼的主要區別是什麼？各舉出一個現代的例子。
3. 什麼是 Feistel 密碼結構？簡述其加密過程中的基本步驟。
4. DES 加密演算法的主要特性是什麼？其金鑰長度為何？現今為何不再推薦單獨使用 DES？
5. AES 的設計目標是什麼？與 DES 相比，AES 的主要優勢有哪些？
6. 請解釋電子密碼本 (ECB) 和密碼區塊鏈 (CBC) 這兩種區塊密碼運作模式的主要差異。ECB 模式的主要缺點是什麼？
7. 什麼是初始向量 (IV)？在使用 CBC 模式時，IV 的重要性為何？
8. 請簡述輸出回饋 (OFB) 模式和計數器 (CTR) 模式的工作原理。這兩種模式有哪些主要優點？
9. 在選擇加密裝置的放置位置時，鏈路加密和端到端加密各有什麼優缺點？在 OSI 模型中，這兩種加密通常發生在哪幾層？
10. 簡述對稱式加密中金鑰分配的主要挑戰。列舉至少兩種可能的金鑰分配方法。

## 隨堂測驗解答

1. 對稱式加密的主要原則是發送者和接收者共享相同的秘密金鑰來進行加密和解密。古典的對稱式加密演算法的例子是凱撒密碼，它通過將明文中的每個字母在字母表中向前或向後移動固定的位數來產生密文。
2. 區塊密碼將訊息分割成固定大小的區塊進行加密，而串流密碼則逐位元或逐位元組地處理訊息串流。一個現代區塊密碼的例子是 AES，一個現代串流密碼的例子是 RC4。
3. Feistel 密碼結構將輸入區塊分成左右兩個相等的部分，並通過多輪迭代進行加密。每一輪都使用輪函數和子金鑰對左半部分進行替換，替換的結果與右半部分進行 XOR 運算，然後交換左右兩部分（最後一輪可能不交換）。
4. DES 的主要特性是它是一個 64 位元的區塊密碼，使用 56 位元的金鑰。由於金鑰長度相對較短，現在已經可以通過暴力破解等方式在合理時間內破解 DES，因此不再推薦單獨使用。
5. AES 的設計目標是提供比三重 DES 更強、更快的私鑰對稱式區塊密碼，並具有長期的有效性。與 DES 相比，AES 的主要優勢在於其更大的金鑰長度（128、192 或 256 位元）和更安全的演算法結構。
6. 在 ECB 模式下，訊息的每個區塊都獨立地使用相同的金鑰進行加密，相同的明文區塊會產生相同的密文區塊。在 CBC 模式下，每個明文區塊在加密前都與前一個密文區塊進行 XOR 運算，這使得相同的明文區塊在不同的位置會產生不同的密文區塊。ECB 模式的主要缺點是如果訊息中存在重複的明文區塊，這些重複模式也會在密文中顯現出來，容易受到分析攻擊。
7. 初始向量 (IV) 是一個隨機或偽隨機的值，在 CBC 等區塊密碼的某些運作模式中用於開始加密過程。在使用 CBC 模式時，IV 的重要性在於確保即使使用相同的金鑰加密相同的明文，每次產生的密文也會不同，從而提高安全性。IV 通常需要公開傳輸，但不應該被預測或重複使用。
8. 在 OFB 模式下，區塊密碼的輸出被作為下一次加密的輸入，並與明文進行 XOR 運算。產生的密文和下一次加密的輸入是相互獨立的。在 CTR 模式下，一個計數器被加密，然後將加密後的計數器與明文進行 XOR 運算。這兩種模式的主要優點包括允許並行加密和解密，並且錯誤不會傳播。
9. 鏈路加密在每個通訊鏈路上獨立進行加密，需要解密中間節點的流量，保護鏈路上的數據，但無法隱藏端到端的流量模式。它通常發生在 OSI 模型的物理層 (第 1 層) 或資料鏈路層 (第 2 層)。端到端加密在原始發送者和最終接收者之間進行加密，保護數據內容的機密性和完整性，但標頭必須保持明文以進行路由，因此無法隱藏流量模式。它可以發生在 OSI 模型的網路層 (第 3 層)、傳輸層 (第 4 層)、會話層 (第 5 層)、表示層 (第 6 層) 或應用層 (第 7 層)。
10. 對稱式加密中金鑰分配的主要挑戰是如何在通信雙方之間安全地共享秘密金鑰，以防止被未經授權的第三方獲取。可能的金鑰分配方法包括：由一方選擇金鑰並通過安全的物理通道傳遞給另一方；使用受信任的第三方（金鑰分配中心）來生成和分發金鑰；如果雙方先前有安全的通信，可以使用之前的金鑰來加密新的金鑰；或者利用 Diffie-Hellman 等金鑰交換協議在不共享秘密資訊的情況下協商出共享金鑰。

## 申論題 (不提供答案)

1. 比較和對比古典替換式密碼和置換式密碼的原理和弱點。舉例說明每種類型的一種古典密碼，並討論如何針對這些密碼進行密碼分析。
2. 詳細解釋 Feistel 密碼結構在現代區塊密碼設計中的重要性。描述 DES 加密演算法中 Feistel 結構的具體應用，並討論其設計中的關鍵組件（如 S-盒和金鑰排程）如何影響其安全性。
3. 探討 AES 被選為新一代加密標準的原因。分析 AES 設計中體現的安全性、效率和靈活性原則，並與 DES 的局限性進行比較。
4. 詳細比較和對比密碼區塊鏈 (CBC)、密碼回饋 (CFB)、輸出回饋 (OFB) 和計數器 (CTR) 這四種主要的區塊密碼運作模式。討論每種模式的適用場景、優缺點以及對安全性的影響。
5. 分析在不同網路層級（例如鏈路層和應用層）進行加密的優缺點。討論流量分析的威脅，以及鏈路加密和流量填充等技術如何應對這種威脅。同時探討在大型網路環境中安全有效進行金鑰分配所面臨的挑戰和可能的解決方案。

## 關鍵術語詞彙表

- **明文 (plaintext)**: 未經加密的原始訊息。
- **密文 (ciphertext)**: 經過加密處理後的訊息。
- **金鑰 (key)**: 在加密和解密過程中使用的秘密資訊。
- **加密 (encryption)**: 將明文轉換為密文的過程。
- **解密 (decryption)**: 將密文轉換回明文的過程。
- **密碼 (cipher)**: 用於執行加密和解密的演算法。
- **密碼學 (cryptography)**: 研究加密和解密技術的學科。
- **密碼分析 (cryptanalysis)**: 研究在不知道金鑰的情況下破解密文的技術。
- **對稱式加密 (symmetric encryption)**: 加密和解密使用相同金鑰的加密系統。
- **非對稱式加密 (asymmetric encryption)**: 加密和解密使用不同金鑰（公開金鑰和私密金鑰）的加密系統。
- **區塊密碼 (block cipher)**: 將明文分成固定大小的區塊進行加密的密碼。
- **串流密碼 (stream cipher)**: 逐位元或逐位元組地加密明文的密碼。
- **替換 (substitution)**: 一種加密技術，將明文中的單元（例如字母、位元組）替換為其他單元。
- **置換 (transposition)**: 一種加密技術，重新排列明文中單元的順序。
- **乘積密碼 (product cipher)**: 通過組合多個替換和置換操作而形成的密碼。
- **暴力破解 (brute-force attack)**: 通過嘗試所有可能的金鑰來破解密文的攻擊方法。
- **Feistel 密碼結構 (Feistel cipher structure)**: 一種用於構建區塊密碼的結構，通過多輪迭代的替換和置換操作來實現加密。
- **DES (Data Encryption Standard)**: 一種已被廣泛使用的對稱式區塊密碼，使用 56 位元金鑰加密 64 位元資料區塊。
- **AES (Advanced Encryption Standard)**: 一種現代的對稱式區塊密碼，被選為 DES 的替代者，支援 128、192 和 256 位元的金鑰長度。
- **金鑰排程 (key schedule)**: 在區塊密碼中，從主金鑰產生每一輪加密所需的子金鑰的過程。
- **S-盒 (Substitution box)**: 區塊密碼中執行非線性替換操作的組件。
- **P-盒 (Permutation box)**: 區塊密碼中執行位元置換操作的組件。
- **運作模式 (mode of operation)**: 將區塊密碼應用於比其區塊大小更長的資料的方法，包括 ECB、CBC、CFB、OFB 和 CTR 等。
- **ECB (Electronic Codebook)**: 一種區塊密碼運作模式，每個明文區塊獨立加密。
- **CBC (Cipher Block Chaining)**: 一種區塊密碼運作模式，每個明文區塊在加密前與前一個密文區塊進行 XOR 運算。
- **IV (Initialization Vector)**: 在 CBC 和其他模式中使用的隨機或偽隨機值，以確保相同的明文產生不同的密文。
- **CFB (Cipher Feedback)**: 一種區塊密碼運作模式，其加密過程類似於串流密碼，密文的一部分回饋到下一輪的輸入。
- **OFB (Output Feedback)**: 一種區塊密碼運作模式，區塊密碼的輸出回饋到下一輪的輸入，產生一個獨立於明文的密鑰串流。
- **CTR (Counter)**: 一種區塊密碼運作模式，通過加密一個計數器並將結果與明文進行 XOR 運算來實現加密。
- **RC4**: 一種廣泛使用的串流密碼。
- **鏈路加密 (link encryption)**: 在通信鏈路的每一段上獨立進行加密。
- **端到端加密 (end-to-end encryption)**: 在訊息的原始發送者和最終接收者之間進行加密。
- **流量分析 (traffic analysis)**: 通過監控網路流量模式來推斷通信內容或參與者的技術。
- **流量填充 (traffic padding)**: 在網路流量中添加虛假數據以隱藏實際流量模式的技術。
- **金鑰分配中心 (KDC, Key Distribution Center)**: 一個受信任的第三方，負責生成和分發會期金鑰。
- **會期金鑰 (session key)**: 用於單個通信會話的臨時金鑰。
- **主金鑰 (master key)**: 用於加密會期金鑰的長期共享金鑰。

RSA 金鑰設置 (Key Setup)

每個 RSA 使用者都需要產生一對公鑰和私鑰，步驟如下 :

1. 隨機選擇兩個大的質數：p 和 q 。

2. 計算系統模數 n：$n = pq$ ...。同時，計算 $\phi(n) = (p-1)(q-1)$ 。

3. 隨機選擇加密金鑰 e：e 必須滿足 $1 < e < \phi(n)$ 且 $gcd(e, \phi(n)) = 1$ 。

4. 計算解密金鑰 d：d 是 e 在模 $\phi(n)$ 下的乘法逆元，滿足 $ed \equiv 1 \pmod{\phi(n)}$ 且 $0 \le d \le n$ 。可以使用擴展歐幾里得演算法來求解 d .

5. 公開加密金鑰 (公鑰)$PU：{e, n}$ 。

6. 保密解密金鑰 (私鑰) $PR：{d, n}$ 。